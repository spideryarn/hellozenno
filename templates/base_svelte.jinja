{% macro load_svelte_component(component_name, props={}, component_id='') %}
  <div id="{{ component_id if component_id else component_name | lower + '-component' }}" data-svelte-component="{{ component_name }}"></div>
  {% if not config.IS_PRODUCTION %}
    {# Development mode - use Vite dev server #}
    <script type="module">
      // Debug flags and helper function
      const SVELTE_DEBUG = true;
      console.log('SVELTE DEV COMPONENT LOADING ATTEMPT');
      const debugLog = SVELTE_DEBUG ? (msg, ...args) => console.log(`[SVELTE DEBUG] ${msg}`, ...args) : () => {};
      
      // Log initial attempt
      debugLog(`Starting mount for ${JSON.stringify({
        component: "{{ component_name }}",
        mountPoint: "{{ component_id if component_id else component_name | lower + '-component' }}",
        props: {{ props | tojson | safe }},
        viteDev: true
      })}`);
      
      // Immediately log what we're going to try to import
      const importUrl = 'http://localhost:5173/src/entries/{{ component_name | lower }}.ts';
      debugLog("Import URL:", importUrl);
      
      try {
        // Dynamic import
        import(importUrl).then(
          module => {
            debugLog("Module imported successfully");
            
            if (!module.default) {
              throw new Error(`Module ${importUrl} does not have a default export`);
            }
            
            // Find target element
            const targetElement = document.getElementById('{{ component_id if component_id else component_name | lower + "-component" }}');
            
            if (!targetElement) {
              throw new Error(`Target element #{{ component_id if component_id else component_name | lower + "-component" }} not found`);
            }
            
            // Mount component
            const props = {{ props | tojson | safe }};
            const component = module.default(targetElement, props);
            debugLog("Component mounted successfully");
          },
          error => {
            console.error(`Failed to import ${importUrl}:`, error);
          }
        );
      } catch (error) {
        console.error(`Error loading Svelte component {{ component_name }}:`, error);
      }
    </script>
  {% else %}
    {# Production mode - use built files #}
    <script type="module">
      // Debug flags and helper function - no-op in production
      const debugLog = () => {};
      
      try {
        // Use the correct filename pattern that matches vite.config.js output configuration
        const importUrl = "{{ url_for('static', filename='build/js/' + component_name | lower + '.js') }}";
        
        // Dynamic import
        import(importUrl).then(
          module => {
            // Find target element
            const targetElement = document.getElementById('{{ component_id if component_id else component_name | lower + "-component" }}');
            
            if (!targetElement) {
              throw new Error(`Target element #{{ component_id if component_id else component_name | lower + "-component" }} not found`);
            }
            
            // Mount component
            const props = {{ props | tojson | safe }};
            const component = module.default(targetElement, props);
          },
          error => {
            console.error(`Failed to import ${importUrl}:`, error);
          }
        );
      } catch (error) {
        console.error(`Error loading Svelte component {{ component_name }}:`, error);
      }
    </script>
  {% endif %}
{% endmacro %} 